{
  "postjobexecution": {
    "Node10": {
      "target": "postinstallcert.js",
      "argumentFormat": ""
    },
    "Node16": {
      "target": "postinstallcert.js",
      "argumentFormat": ""
    }
  },
  "messages": {
    "InstallRequiresMac": "Install Apple Certificate requires a macOS agent. Installing Apple Certificates on Linux or Windows is not supported by Apple.",
    "SetKeyPartitionListCommandFailed": "Error setting the partition_id ACL for the private key. Verify that the `Keychain password` is correct, or use a `Temporary Keychain` instead.",
    "INVALID_P12": "Unable to find the certificate SHA1 hash and common name (CN). Verify that the certificate is a valid P12.",
    "CertNotValidYetError": "Certificate \"%s\" (fingerprint: %s) isn't valid until %s",
    "NoP12PwdWarning": "No P12 password was supplied. If the P12 file requires a password, the best practice is to supply it as pipeline variable and mark it secret by enabling the lock icon.",
    "P12PrivateKeyNameNotFound": "Failed to identify the private key name: %s",
    "SetKeyPartitionListCommandNotFound": "Skipping unnecessary keychain partition_id ACL assignment on this older OS. The security command 'set-key-partition-list' was introduced in macOS Sierra (10.12).",
    "CertExpiredError": "Certificate \"%s\" (fingerprint: %s) expired on %s"
  },
  "prejobexecution": {
    "Node10": {
      "target": "preinstallcert.js",
      "argumentFormat": ""
    },
    "Node16": {
      "target": "preinstallcert.js",
      "argumentFormat": ""
    }
  },
  "friendlyName": "Install Apple certificate (Side-by-side)",
  "author": "Microsoft Corporation",
  "demands": [
    "xcode"
  ],
  "visibility": [
    "Build",
    "Release"
  ],
  "minimumAgentVersion": "2.182.1",
  "description": "Install an Apple certificate required to build on a macOS agent machine",
  "restrictions": {
    "settableVariables": {
      "allowed": [
        "signingIdentity",
        "keychainPassword",
        "keychainPath",
        "APPLE_CERTIFICATE_SIGNING_IDENTITY",
        "APPLE_CERTIFICATE_KEYCHAIN"
      ]
    },
    "commands": {
      "mode": "restricted"
    }
  },
  "inputs": [
    {
      "name": "certSecureFile",
      "required": true,
      "defaultValue": "",
      "type": "secureFile",
      "helpMarkDown": "Select the certificate (.p12) that was uploaded to `Secure Files` to install on the macOS agent.",
      "label": "Certificate (P12)"
    },
    {
      "required": false,
      "helpMarkDown": "Password to the Apple certificate (.p12). Use a new build variable with its lock enabled on the `Variables` tab to encrypt this value.",
      "label": "Certificate (P12) password",
      "name": "certPwd",
      "type": "string"
    },
    {
      "defaultValue": "temp",
      "name": "keychain",
      "options": {
        "temp": "Temporary Keychain",
        "custom": "Custom Keychain",
        "default": "Default Keychain"
      },
      "required": true,
      "groupName": "advanced",
      "type": "pickList",
      "label": "Keychain",
      "helpMarkDown": "Select the keychain in which to install the Apple certificate. For Microsoft hosted builds, use `Temporary Keychain`. A temporary keychain will always be deleted after the build or release is complete."
    },
    {
      "name": "keychainPassword",
      "required": true,
      "visibleRule": "keychain = custom || keychain = default",
      "type": "string",
      "helpMarkDown": "Password to unlock the keychain. Use a new build variable with its lock enabled on the `Variables` tab to encrypt this value.",
      "groupName": "advanced",
      "label": "Keychain password"
    },
    {
      "name": "customKeychainPath",
      "required": true,
      "visibleRule": "keychain = custom",
      "type": "string",
      "helpMarkDown": "Full path to a custom keychain file. The keychain will be created if it does not exist.",
      "groupName": "advanced",
      "label": "Custom keychain path"
    },
    {
      "name": "deleteCert",
      "required": false,
      "visibleRule": "keychain = custom || keychain = default",
      "type": "boolean",
      "helpMarkDown": "Select to delete the certificate from the keychain after the build or release is complete.",
      "groupName": "advanced",
      "label": "Delete certificate from keychain"
    },
    {
      "name": "deleteCustomKeychain",
      "required": false,
      "visibleRule": "keychain = custom",
      "type": "boolean",
      "helpMarkDown": "Select to delete the custom keychain from the agent after the build or release is complete.",
      "groupName": "advanced",
      "label": "Delete custom keychain"
    },
    {
      "name": "signingIdentity",
      "required": false,
      "type": "string",
      "helpMarkDown": "The Common Name of the subject in the signing certificate.  Will attempt to parse the Common Name if this is left empty.",
      "groupName": "advanced",
      "label": "Certificate signing identity"
    },
    {
      "name": "setUpPartitionIdACLForPrivateKey",
      "required": false,
      "type": "boolean",
      "helpMarkDown": "If true - sets the partition_id ACL for the imported private key, so codesign won't prompt to use the key for signing. This isn't necessary for temporary keychains, at least on MacOS High Sierra. See the [link](http://www.openradar.me/28524119) for more details.",
      "groupName": "advanced",
      "label": "Set up partition_id ACL for the imported private key"
    }
  ],
  "groups": [
    {
      "isExpanded": true,
      "displayName": "Advanced",
      "name": "advanced"
    }
  ],
  "releaseNotes": "Fixes codesign hangs on a self hosted agent. A Keychain password is now required to use `Default Keychain` or `Custom Keychain`. Microsoft hosted builds should use `Temporary Keychain`.",
  "outputVariables": [
    {
      "name": "signingIdentity",
      "description": "The resolved Common Name of the subject in the signing certificate. Either supplied as an input or parsed from the P12 certificate file."
    },
    {
      "name": "keychainPath",
      "description": "The path for the keychain file with the certificate."
    }
  ],
  "name": "InstallAppleCertificate-sxs",
  "id": "a0a0f697-cc4b-5bd3-bc8d-22ad9c77baab",
  "version": {
    "Major": 2,
    "Patch": 0,
    "Minor": 214
  },
  "helpUrl": "https://docs.microsoft.com/azure/devops/pipelines/tasks/utility/install-apple-certificate",
  "category": "Utility",
  "runsOn": [
    "Agent",
    "DeploymentGroup"
  ],
  "instanceNameFormat": "Install an Apple certificate",
  "helpMarkDown": "[Learn more about this task](https://go.microsoft.com/fwlink/?LinkID=862067)"
}
