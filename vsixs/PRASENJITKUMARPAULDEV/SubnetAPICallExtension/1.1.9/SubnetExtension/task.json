{"id":"b2ce8b90-af23-4798-ac96-1713cbaf286b","name":"SUBNETAPICALLTASK","friendlyName":"SUBNETAPICALLTASK","description":"Subnets enable you to segment a virtual network into one or more sub-networks and allocate a portion of the virtual network's address space to each subnet.","author":"MAPS","helpMarkDown":"Please see the <a href=\"https://digitalfoundations.visualstudio.com/MAPS%20Archetypes/_wiki/wikis/MAPS-Archetypes.wiki/908/Subnet-Creation-Utility\">MAPS Subnet Creation Utility</a> wiki page for more information and a guide on how to provision this resource.\r\n\rFor even further detail, please see the subnet section on the <a href=\"https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview#:~:text=Subnets%3A%20Subnets%20enable%20you%20to,resources%20in%20a%20specific%20subnet.\">Microsoft What is Azure Virtual Network?</a> page.","category":"Utility","visibility":["Build","Release"],"demands":[],"version":{"Major":"1","Minor":"1","Patch":"9"},"minimumAgentVersion":"1.34.0","instanceNameFormat":"SubnetUtility $(message)","inputs":[{"name":"ConnectedServiceName","type":"connectedService:AzureRM","label":"Azure Subscription","defaultValue":"","required":true,"helpMarkDown":"The dropdown will populate the azure subscriptions you have access to as a part of this VSTS project"},{"name":"rsgName","type":"picklist","label":"V-Net Resource Group","required":true,"helpMarkDown":"The dropdown lists all the Resource Groups to which the above selected service endpoint has access to. Choose the VNet Resource Group with name as *-net-rsg","validation":{"expression":"isMatch(value,'^([0-9]|[a-z]|[A-Z]|-)*-net-rsg$','IgnoreCase')","message":"Please select a valid network resource group from the drop down list. Name should end with '-net-rsg'."}},{"name":"vnet","type":"picklist","label":"Virtual Network","required":true,"helpMarkDown":"Please select the Virtual network name","properties":{"EditableOptions":"True"}},{"name":"Udr","type":"picklist","label":"UDR","required":true,"helpMarkDown":"User Defined Routes (UDRs) allow network admins to control the routing tables between subnets, within a subnet, and as well as between virtual networks thereby allowing for greater control over network traffic flow.\r\n\rPlease select the UDR that is structured for what you will be using this subnet for."},{"name":"nsg","type":"picklist","label":"NSG","required":true,"helpMarkDown":"A network security group (NSG) is a way to activate a rule or access control list (ACL), which will allow or deny network traffic.\r\n\rPlease select the NSG that is structured for what you will be using this subnet for.","properties":{"EditableOptions":"True"}},{"name":"Mask","type":"string","label":"Mask","defaultValue":"","required":true,"helpMarkDown":"Mask value of the subnet (should be 19 to 29)","validation":{"expression":"isMatch(value,'^(19|[2][0-9])$','IgnoreCase')","message":"Please enter value greater than 18 and less than or equals to 29"}},{"name":"usersubname","type":"string","label":"User Subnet Name","required":true,"helpMarkDown":"User input to include as part of Subnet name. Max 6 characters","validation":{"expression":"isMatch(value,'^[a-zA-Z0-9]{1,6}$','IgnoreCase')","message":"Maximum 6 characters are allowed"}}],"dataSourceBindings":[{"target":"rsgName","endpointId":"$(ConnectedServiceName)","endpointUrl":"{{{endpoint.url}}}/subscriptions/$(endpoint.subscriptionId)/resourceGroups?api-version=2019-05-10","resultSelector":"jsonpath:$.value[?(@.name =~ /.*-net-rsg/i)].name"},{"target":"Udr","endpointId":"$(ConnectedServiceName)","endpointUrl":"{{{endpoint.url}}}/subscriptions/$(endpoint.subscriptionId)/providers/Microsoft.Network/routeTables?api-version=2018-01-01","resultSelector":"jsonpath:$.value[*].name"},{"target":"nsg","endpointId":"$(ConnectedServiceName)","endpointUrl":"{{{endpoint.url}}}/subscriptions/$(endpoint.subscriptionId)/resourceGroups/$(rsgName)/providers/Microsoft.Network/networkSecurityGroups?api-version=2018-01-01","resultSelector":"jsonpath:$.value[*].name","parameters":{"rsgName":"$(rsgName)"}},{"target":"vnet","endpointId":"$(ConnectedServiceName)","endpointUrl":"{{{endpoint.url}}}/subscriptions/$(endpoint.subscriptionId)/providers/Microsoft.Network/virtualNetworks?api-version=2018-07-01","resultSelector":"jsonpath:$.value[*].name"}],"execution":{"PowerShell3":{"target":"sample.ps1"}},"OutputVariables":[{"name":"subnetName","description":"This is the output variable for the name of the created subnet.  To use this variable in subsequent tasks, enter a reference name in the above input field, then you can use the variable as $(referenceName.subnetName)"},{"name":"subnetSubscriptionName","description":"This is the output variable for the name of the azure subscription the subnet is created in.  To use this variable in subsequent tasks, enter a reference name in the above input field, then you can use the variable as $(referenceName.subnetSubscriptionName)"},{"name":"subnetRSGName","description":"This is the output variable for the name of the resource group the subnet is stored in.  To use this variable in subsequent tasks, enter a reference name in the above input field, then you can use the variable as $(referenceName.subnetRSGName)"}]}
