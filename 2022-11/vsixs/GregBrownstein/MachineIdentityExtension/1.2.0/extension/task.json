{"$schema":"https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json","id":"fe725709-3b76-4504-8d6a-a280c20d6ef3","name":"MachineIdentityExtension","friendlyName":"Machine Identity Extension","description":"Simplify key generation and enrollment of machine identities (also known as SSL/TLS certificates and keys) with Venafi as a Service or Trust Protection Platform","helpMarkDown":"If using TPP, v20.1 or greater is required.","category":"Azure Pipelines","visibility":["Build","Release"],"author":"Greg Brownstein","version":{"Major":"1","Minor":"2","Patch":"0"},"instanceNameFormat":"$(serverType) $(action)","groups":[{"name":"mainGroup","displayName":"Main","isExpanded":true},{"name":"requestGroup","displayName":"Request Certificate","isExpanded":false,"visibleRule":"action = request"},{"name":"retrieveGroup","displayName":"Retrieve Certificate","isExpanded":false,"visibleRule":"action = retrieve"},{"name":"renewGroup","displayName":"Renew Certificate","isExpanded":false,"visibleRule":"action = renew"},{"name":"getTokenGroup","displayName":"Get Token","isExpanded":false,"visibleRule":"action = getToken"},{"name":"advanced","displayName":"Advanced","isExpanded":false}],"inputs":[{"name":"action","type":"pickList","label":"Action","defaultValue":"request","required":true,"helpMarkDown":"Select the action to perform","options":{"request":"Request Certificate","retrieve":"Retrieve Certificate","renew":"Renew Certificate","getToken":"Get Token (TPP only)","revokeToken":"Revoke Token (TPP only)"}},{"name":"serverType","type":"radio","label":"Server Type","defaultValue":"tpp","required":true,"helpMarkDown":"Server type to connect to","options":{"cloud":"Venafi as a Service","tpp":"Trust Protection Platform (TPP)"},"visibleRule":"action != getToken","groupName":"mainGroup"},{"name":"serverUrlTpp","type":"string","label":"Server URL","defaultValue":"","required":true,"helpMarkDown":"TPP server URL, eg. tpp.venafi.example. 'https://' will be appended automatically.","visibleRule":"serverType = tpp || action = getToken","groupName":"mainGroup"},{"name":"authTokenFrom","type":"radio","label":"Auth Token From","defaultValue":"priorGetToken","required":true,"helpMarkDown":"You can either provide your token directly or use a token obtained from a prior Get Token action","options":{"priorGetToken":"Prior Get Token","inline":"Inline"},"visibleRule":"serverType = tpp && action != getToken","groupName":"mainGroup"},{"name":"authToken","type":"string","label":"Auth Token","defaultValue":"","required":true,"helpMarkDown":"Authentication token to connect to TPP.","visibleRule":"serverType = tpp && authTokenFrom = inline && action != getToken","groupName":"mainGroup"},{"name":"apiKey","type":"string","label":"API Key","defaultValue":"","required":true,"helpMarkDown":"API key for Venafi as a Service found under user profile->preferences.<br/><br/>Example: vvvvvvvv-wwww-xxxx-yyyy-zzzzzzzzzzzz","visibleRule":"serverType = cloud","groupName":"mainGroup"},{"name":"requestDestination","type":"string","label":"Destination","defaultValue":"","required":true,"helpMarkDown":"Certificate destination.<br/><br/>Venafi as a Service: Application and associated issuing template in the form application\\template<br/><br/>TPP: Folder path. \\VED\\Policy\\ will be prepended, you only need to specify child folders under the root Policy folder.<br/>Example: DevOps\\CorpApp","groupName":"requestGroup","visibleRule":"action = request"},{"name":"requestCommonName","type":"string","label":"Common Name (CN)","defaultValue":"","required":true,"groupName":"requestGroup","visibleRule":"action = request"},{"name":"requestKeyPassword","type":"string","label":"Private Key Password","defaultValue":"","required":false,"helpMarkDown":"Password for encrypting the private key.  Specifying a value here will override the default non-encrypted private key.  It is recommended to use a secret variable, <https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch#secret-variables>.","groupName":"requestGroup"},{"name":"requestFormat","type":"radio","label":"Format","defaultValue":"pem","required":true,"options":{"pem":"PEM","json":"JSON","pkcs12.file":"PKCS#12","jks.file":"JKS"},"helpMarkDown":"","groupName":"requestGroup"},{"name":"requestChain","type":"radio","label":"Chain","defaultValue":"root-last","required":true,"options":{"root-last":"Root Last","root-first":"Root First","ignore":"Ignore"},"helpMarkDown":"Use to include the certificate chain in the output, and to specify where to place it in the file.","groupName":"requestGroup"},{"name":"requestCsrTpp","type":"radio","label":"Certificate Signing Request (CSR)","defaultValue":"local","required":false,"options":{"local":"Local","service":"Service","file":"File"},"visibleRule":"serverType = tpp","helpMarkDown":"Specify the CSR and private key location.<br/><br/>Local: private key and CSR will be generated locally<br/>Service: private key and CSR will be generated within Venafi Platform<br/>File: CSR will be read from a file by name","groupName":"requestGroup"},{"name":"requestCsrCloud","type":"radio","label":"Certificate Signing Request (CSR)","defaultValue":"local","required":false,"options":{"local":"Local","file":"File"},"visibleRule":"serverType = cloud","helpMarkDown":"Specify the CSR and private key location.<br/><br/>Local: private key and CSR will be generated locally<br/>File: CSR will be read from a file by name","groupName":"requestGroup"},{"name":"requestCsrFile","type":"filePath","label":"CSR File","defaultValue":"","required":true,"helpMarkDown":"File to read the CSR from","visibleRule":"requestCsrTpp = file || requestCsrCloud = file","groupName":"requestGroup"},{"name":"requestSanDns","type":"string","label":"DNS SAN","defaultValue":"","required":false,"helpMarkDown":"Use to specify a DNS Subject Alternative Name. To specify more than one, separate with a comma.","groupName":"requestGroup"},{"name":"requestSanEmailTpp","type":"string","label":"Email SAN","defaultValue":"","required":false,"visibleRule":"serverType = tpp","helpMarkDown":"Use to specify a Email Subject Alternative Name. To specify more than one, separate with a comma.","groupName":"requestGroup"},{"name":"requestSanIpTpp","type":"string","label":"IP SAN","defaultValue":"","required":false,"visibleRule":"serverType = tpp","helpMarkDown":"Use to specify a IP Subject Alternative Name. To specify more than one, separate with a comma.","groupName":"requestGroup"},{"name":"requestNicknameTpp","type":"string","label":"New Certificate Name","defaultValue":"","required":false,"visibleRule":"serverType = tpp","helpMarkDown":"Create a new certificate with the same CN, but a distinct object in TPP.","groupName":"requestGroup"},{"name":"requestCustomFieldsTpp","type":"multiLine","label":"Custom Fields","required":false,"defaultValue":"","visibleRule":"serverType = tpp","groupName":"requestGroup","helpMarkDown":"Enter custom fields in json format.  To provide more than 1 value per name, separate the values with a comma.  Click on the elipsis to edit easily.","properties":{"editorExtension":"ms.vss-services-azure.azure-servicebus-message-grid"}},{"name":"requestNoRetrieve","label":"Retrieve Certificate Later","defaultValue":false,"required":false,"type":"boolean","helpMarkDown":"By default, we will try to retrieve the certificate for 60 seconds.  If your CA might not respond in time or your workflow requires it, you can choose to forgo retrieving the certificate now and do so later with the certificate id which is automatically saved as environment variable VENAFI_ID.","groupName":"requestGroup"},{"name":"requestOutputType","type":"radio","label":"Certificate Output","defaultValue":"envVar","required":true,"options":{"envVar":"Environment variable","file":"File"},"helpMarkDown":"Output to either a file or an environment variable, VENAFI_CERT, to be used in a subsequent task.  The option for an environment variable is only available for pem and json formats.","visibleRule":"requestFormat NotEndsWith .file && requestNoRetrieve = false","groupName":"requestGroup"},{"name":"requestOutputFile","type":"filePath","label":"Certificate Output File Path","defaultValue":"","required":true,"visibleRule":"requestOutputType = file || requestFormat EndsWith .file","helpMarkDown":"Path to output file.  Required if output type 'File' was selected or format is either PKCS#12 or JKS.","groupName":"requestGroup"},{"name":"retrieveIdFrom","type":"radio","label":"Certificate ID From","defaultValue":"priorRequest","required":true,"options":{"priorRequest":"Prior Request","id":"ID","file":"File path"},"helpMarkDown":"Where to get the certificate ID from.<br/><br/>Prior Request: From a Request action earlier in the pipeline.<br/>ID: provide the certificate ID directly<br/>File path: provide the path to a file which contains the certificate ID","visibleRule":"action = retrieve","groupName":"retrieveGroup"},{"name":"retrieveId","type":"string","label":"Certificate ID","defaultValue":"","required":true,"helpMarkDown":"ID for certificate to retrieve.<br/><br/>Venafi as a Service: format is a GUID<br/><br/>TPP: path to the certificate excluding \\ved\\policy\\, eg. DevOps Certificates\\demo-pickup.venafi.example","visibleRule":"retrieveIdFrom = id","groupName":"retrieveGroup"},{"name":"retrieveFile","type":"filePath","label":"File Path","defaultValue":"","required":true,"visibleRule":"retrieveIdFrom = file","groupName":"retrieveGroup"},{"name":"retrieveFormat","type":"radio","label":"Format","defaultValue":"pem","required":true,"options":{"pem":"PEM","json":"JSON","pkcs12":"PKCS#12","jks":"JKS"},"helpMarkDown":"","groupName":"retrieveGroup"},{"name":"retrieveOutputType","type":"radio","label":"Certificate Output","defaultValue":"envVar","required":true,"options":{"envVar":"Environment variable","file":"File"},"helpMarkDown":"Output to either a file or an environment variable, VENAFI_CERT, to be used in a subsequent task.  The option for an environment variable is only available for pem and json formats.","visibleRule":"retrieveFormat = pem || retrieveFormat = json","groupName":"retrieveGroup"},{"name":"retrieveOutputFile","type":"filePath","label":"Certificate Output File Path","defaultValue":"","required":true,"visibleRule":"retrieveOutputType = file || retrieveFormat = pkcs12 || retrieveFormat = jks","helpMarkDown":"Path to output file.  Required if output type 'file' was selected or format is either PKCS#12 or JKS.","groupName":"retrieveGroup"},{"name":"renewIdFrom","type":"radio","label":"Certificate ID From","defaultValue":"priorRequest","required":true,"options":{"priorRequest":"Prior Request","id":"ID","file":"File path"},"helpMarkDown":"Where to get the certificate ID from.<br/><br/>Prior Request: From a Request action earlier in the pipeline.<br/>ID: provide the renew ID<br/>File path: provide the path to a file which contains the renew ID","visibleRule":"action = renew","groupName":"renewGroup"},{"name":"renewId","type":"string","label":"ID","defaultValue":"","required":true,"helpMarkDown":"ID for certificate to renew.<br/><br/>Venafi as a Service: format is a GUID<br/><br/>TPP: path to the certificate excluding \\ved\\policy\\, eg. DevOps Certificates\\demo-pickup.venafi.example","visibleRule":"renewIdFrom = id","groupName":"renewGroup"},{"name":"renewFile","type":"filePath","label":"File Path","defaultValue":"","required":true,"visibleRule":"renewIdFrom = file","groupName":"renewGroup"},{"name":"getTokenUsername","type":"string","label":"Username","defaultValue":"","required":true,"helpMarkDown":"","visibleRule":"action = getToken","groupName":"getTokenGroup"},{"name":"getTokenPassword","type":"string","label":"Password","defaultValue":"","required":true,"helpMarkDown":"","visibleRule":"action = getToken","groupName":"getTokenGroup"},{"name":"getTokenClientId","type":"string","label":"Application Name","defaultValue":"","required":false,"helpMarkDown":"If not provided, 'vcert-cli' is the default.","visibleRule":"action = getToken","groupName":"getTokenGroup"},{"name":"getTokenScope","type":"string","label":"Scope","defaultValue":"","required":false,"helpMarkDown":"See <https://docs.venafi.com/Docs/21.2SDK/TopNav/Content/SDK/AuthSDK/r-SDKa-OAuthScopePrivilegeMapping.php?tocpath=Auth%20REST%20for%20token%20management%7C_____5> for details on this value.  Separate multiple scopes with a semicolon.<br/><br/>If the value is not provided, 'certificate:manage,revoke;' is the default which is the minimum required to perform any actions supported by the VCert CLI.","visibleRule":"action = getToken","groupName":"getTokenGroup"},{"name":"verbose","label":"Verbose","defaultValue":false,"required":false,"type":"boolean","helpMarkDown":"Use to increase the level of logging detail, which is helpful when troubleshooting issues.","groupName":"advanced"},{"name":"testMode","label":"Test Mode","defaultValue":false,"required":false,"type":"boolean","helpMarkDown":"Use to test operations without connecting to Venafi Platform. This option is useful for integration tests where the test environment does not have access to Venafi Platform","groupName":"advanced","visibleRule":"action = request || action = retrieve || action = renew"},{"name":"additionalParameters","label":"Additional Parameters","defaultValue":"","required":false,"type":"string","helpMarkDown":"Provide additional names/values for vcert features the extension does not support yet.  Provide just as you would on the command line, eg. --name value --name2 value2.","groupName":"advanced"}],"execution":{"Node10":{"target":"index.js"}}}
